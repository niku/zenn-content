---
title: "Flutter for web ã§ sqlite3 ã® DB ã‚’ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å–å¾—ã—åˆ©ç”¨ã™ã‚‹"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [flutter, sqlite3]
published: true
---

Flutter for web ä¸Šã§ sqlite3 ã® DB ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã€SQL ã‚’ç™ºè¡Œã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€æ–¹æ³•ã‚’ç´¹ä»‹ã™ã‚‹ã€‚

Flutter for web ã‚’ä½¿ã†ã¨ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§å‹•ãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®¹æ˜“ã«ä½œæˆã§ãã‚‹ã€‚è¿‘å¹´ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€å‡¦ç†ã®é«˜åº¦åŒ–ã«ä¼´ã„ sqlite3 ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹æ‰‹æ³•ãŒæ³¨ç›®ã•ã‚Œã¦ã„ã‚‹ã€‚ä»Šå›ã¯ãã® 2 ã¤ã‚’çµ„ã¿åˆã‚ã›ã¦ Flutter for web ã§ sqlite3 ã‚’åˆ©ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨ã§ãã‚‹ã‹è©¦ã—ãŸã€‚

# å‡¦ç†æ¦‚å¿µå›³

```mermaid
sequenceDiagram
ãƒ¦ãƒ¼ã‚¶ãƒ¼ ->> ãƒ–ãƒ©ã‚¦ã‚¶: Webãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
ãƒ–ãƒ©ã‚¦ã‚¶ ->> Webãƒšãƒ¼ã‚¸A: GET /
Webãƒšãƒ¼ã‚¸A ->> ãƒ–ãƒ©ã‚¦ã‚¶: / ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
alt sqlite3.wasmãƒ­ãƒ¼ãƒ‰
ãƒ–ãƒ©ã‚¦ã‚¶ ->> Webãƒšãƒ¼ã‚¸B: GET /sqlite3.wasm
Webãƒšãƒ¼ã‚¸B ->> ãƒ–ãƒ©ã‚¦ã‚¶: /sqlite3.wasm
end
alt main.dbãƒ­ãƒ¼ãƒ‰
ãƒ–ãƒ©ã‚¦ã‚¶ ->> Webãƒšãƒ¼ã‚¸C: GET /main.db
Webãƒšãƒ¼ã‚¸C ->> ãƒ–ãƒ©ã‚¦ã‚¶: /main.db
end
alt SQLç™ºè¡Œ
Note over ãƒ–ãƒ©ã‚¦ã‚¶: SELECT * FROM ...
Note over ãƒ–ãƒ©ã‚¦ã‚¶: | id | value |<br>|  1 |   aaa |<br>|  2 |   bbb |
end

Note over ãƒ–ãƒ©ã‚¦ã‚¶: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆ
ãƒ–ãƒ©ã‚¦ã‚¶ ->> ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
```

# Dart(Flutter) ã® sqlite3 ã‚’æ‰±ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

pub.dev ã‚’ [sqlite ã‹ã¤ web å¯¾å¿œã§æ¤œç´¢](https://pub.dev/packages?q=platform%3Aweb+sqlite) ã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã¿ã¤ã‹ã£ãŸã€‚

- [sqflite_common_ffi_web](https://pub.dev/packages/sqflite_common_ffi_web)
- [sqlite3](https://pub.dev/packages/sqlite3)

sqflite_common_ffi_web ã¯ã€sqlite3 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸï¼ˆsqlite3 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ä¾å­˜ã—ãŸï¼‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã€åˆ©ç”¨ã‚’å®¹æ˜“ã«ã—ãŸãƒ©ãƒƒãƒ‘ãƒ¼ã¨ã¿ãªã›ã‚‹ã®ã§ã€ä»Šå›ã¯å…ƒã¨ãªã£ã¦ã„ã‚‹ sqlite3 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç›´æ¥åˆ©ç”¨ã™ã‚‹ã€‚

# Flutter for web ã‚’åˆ©ç”¨ã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã® SQL åˆ©ç”¨ã«å¿…è¦ãªã‚‚ã®

Flutter for web ã‚’åˆ©ç”¨ã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã® SQL åˆ©ç”¨ã«ã¯ã€ä»¥ä¸‹ 2 ã¤ãŒå¿…è¦ã 

- sqlite3 ã§ä½œæˆã—ãŸ DB ãƒ•ã‚¡ã‚¤ãƒ« (ä¾‹: main.db)
- sqlite3 ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (ä¾‹: sqlite3.wasm)

ãã‚Œãã‚Œã¯ã€HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ä»Šå›ã¯æ‰±ã„ã‚’ç°¡ä¾¿ã«ã™ã‚‹ãŸã‚å…¨ã¦åŒã˜ã‚µã‚¤ãƒˆã‹ã‚‰å–å¾—ã—ã¦ã„ã‚‹ãŒã€åŸç†çš„ã«ã¯åˆ¥ã€…ã® Web ã‚µã‚¤ãƒˆã‹ã‚‰å–å¾—ã§ãã‚‹ã€‚
ãã®ãŸã‚ã©ã“ã‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã¨ã“ã‚ã‹ã‚‰ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å–å¾—ã€è¦‹ãŸç›®ã‚’æ•´ãˆã‚‹ã¨ã„ã£ãŸã“ã¨ã‚‚å¯èƒ½ã ã€‚

# sqlite3.wasm ãƒ­ãƒ¼ãƒ‰

ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ sqlite3 è£½ã® DB ã‚’å–ã‚Šæ‰±ãˆã‚‹ã‚ˆã†ã«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æº–å‚™ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚

sqlite3 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æœ€æ–°ç‰ˆ 2.3.0 ã¯ã€[README ã«è¨˜è¼‰ãŒã‚ã‚‹é€šã‚Š wasm ã‚µãƒãƒ¼ãƒˆ](https://github.com/simolus3/sqlite3.dart/tree/sqlite3-2.3.0/sqlite3#wasm-web-support)ãŒå­˜åœ¨ã™ã‚‹ã€‚

ã“ã® wasm ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Web ã‚µã‚¤ãƒˆã‹ã‚‰ HTTP çµŒç”±ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ `web` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«é…ç½®ã™ã‚‹ã€‚ä»Šå›ã¯ `web/sqlite3.wasm` ã¨ã—ã¦é…ç½®ã—ãŸã€‚Flutter for web ã§ãƒ“ãƒ«ãƒ‰ã—ãŸã¨ãã«ã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ `/sqlite3.wasm` ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€‚
[web/sqlite3.wasm ã‚’ Web ã‚µã‚¤ãƒˆã¸é…ç½®ã™ã‚‹](https://github.com/niku/flutter_for_web_with_sqlite3_sample/commit/113e3b5771e6bba1d636ab4a7b722f797185405a)

sqlite3 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯èª­ã¿è¾¼ã¿å°‚ç”¨ã®é–¢æ•° [`WasmSqlite3.loadFromUrl`](https://pub.dev/documentation/sqlite3/2.3.0/sqlite3.wasm/WasmSqlite3/loadFromUrl.html) ãŒã‚ã‚‹ã®ã§ã€ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã€‚
[HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ sqlite3.wasm ã‚’èª­ã¿è¾¼ã‚€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è¨­å®š](https://github.com/niku/flutter_for_web_with_sqlite3_sample/commit/d4c3e44029cf66723afbac4d6c1c9077b419df09)

# main.db ãƒ­ãƒ¼ãƒ‰

sqlite ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã¯ sqlite3 è£½ã® DB ã‚’ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆçµŒç”±ã§å–å¾—ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ¢ãƒªä¸Šã«å±•é–‹ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚

ä»Šå›ã® DB ã¯ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ä»¥ä¸‹ã®ã‚ˆã†ã« `web` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ `main.db` ã¨ã„ã†åå‰ã§é…ç½®ã—ãŸã€‚Flutter for web ã§ãƒ“ãƒ«ãƒ‰ã—ãŸã¨ãã«ã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ `/main.db` ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€‚
[sqlite3 ã‚³ãƒãƒ³ãƒ‰ã§ DB ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã— Web ã‚µã‚¤ãƒˆã¸é…ç½®ã™ã‚‹](https://github.com/niku/flutter_for_web_with_sqlite3_sample/commit/5e1928eaa320d803704493da68f13b793ff84e20)

```
$ sqlite3 web/main.db
SQLite version 3.43.2 2023-10-10 13:08:14
Enter ".help" for usage hints.
sqlite> CREATE TABLE greetings ( id INTEGER PRIMARY KEY, value TEXT_TYPE NOT NULL );
sqlite> INSERT INTO greetings(value) VALUES('hello');
sqlite> INSERT INTO greetings(value) VALUES('hi');
sqlite> INSERT INTO greetings(value) VALUES('hey');
sqlite> SELECT * FROM greetings;
1|hello
2|hi
3|hey
```

[ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆçµŒç”±ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹](https://github.com/niku/flutter_for_web_with_sqlite3_sample/commit/eb5b70e0c4f201f4ddd2ff9d38ee7267e8bb7c0b#diff-e61eb31d013d12616f5532636a88cfa63631dda8f7829e5424e68542214d1608R92-R93)ã€‚

[ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒã‚¤ãƒŠãƒªã‚’ã€sqlite3 ã® DB ã¨ã—ã¦ãƒ¡ãƒ¢ãƒªã«æ›¸ãè¾¼ã‚€](https://github.com/niku/flutter_for_web_with_sqlite3_sample/commit/eb5b70e0c4f201f4ddd2ff9d38ee7267e8bb7c0b#diff-e61eb31d013d12616f5532636a88cfa63631dda8f7829e5424e68542214d1608R80)ã€‚
ã“ã‚Œã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ¢ãƒªä¸Šã«ä»®æƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ`InMemoryFileSystem`ï¼‰ã‚’ä½œã‚Šã€ä»®æƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ä¸Šã®æŒ‡å®šã—ãŸãƒ‘ã‚¹ï¼ˆä»Šå›ã¯ `my-original-data`ï¼‰ã¸ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒã‚¤ãƒŠãƒªã‚’æ›¸ãè¾¼ã‚€ã¨ã„ã†å½¢ã§è¡Œã£ã¦ã„ã‚‹ã€‚

# SQL ç™ºè¡Œ

ä»®æƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ä¸Šã®æŒ‡å®šã—ãŸãƒ‘ã‚¹ï¼ˆä»Šå›ã¯ `my-original-data`ï¼‰ã‚’æŒ‡å®šã—ã¦ [sqlite ã‚’é–‹ã](https://github.com/niku/flutter_for_web_with_sqlite3_sample/commit/eb5b70e0c4f201f4ddd2ff9d38ee7267e8bb7c0b#diff-e61eb31d013d12616f5532636a88cfa63631dda8f7829e5424e68542214d1608R95)ã€‚

[é–‹ã„ãŸ sqlite ã«å¯¾ã—ã¦ SQL ã‚’å®Ÿè¡Œã™ã‚‹](https://github.com/niku/flutter_for_web_with_sqlite3_sample/commit/eb5b70e0c4f201f4ddd2ff9d38ee7267e8bb7c0b#diff-e61eb31d013d12616f5532636a88cfa63631dda8f7829e5424e68542214d1608R124-R126)ã€‚
çµæœã¯ [`ResultSet`](https://pub.dev/documentation/sqlite3/2.3.0/sqlite3.wasm/ResultSet-class.html) ã¨ã—ã¦å–å¾—ã§ãã‚‹ã€‚

# ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆ

å–å¾—ãŒçµ‚ã‚ã‚Œã°ã€ã‚ã¨ã¯è‡ªç”±ã«æ“ä½œå¯èƒ½ãªã®ã§ã€é€šå¸¸ã® Widget ä½œæˆã¨åŒã˜ã€‚ä»Šå›ã¯ DataTable ã‚’åˆ©ç”¨ã—ã¦[ResultSet ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½œã‚‹](https://github.com/niku/flutter_for_web_with_sqlite3_sample/commit/eb5b70e0c4f201f4ddd2ff9d38ee7267e8bb7c0b#diff-e61eb31d013d12616f5532636a88cfa63631dda8f7829e5424e68542214d1608R127-R136)ã€‚

![](/images/flutter_for_web_with_sqlite3_screenshot.png)

# ã¾ã¨ã‚

Flutter for web ã¨ sqlite3 ã‚’çµ„ã¿åˆã‚ã›ã¦ Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ã“ã¨ãŒã§ããŸã€‚

ä»Šå›ã¯æ‰±ã„ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã€åŒä¸€ã‚µã‚¤ãƒˆã‹ã‚‰ sqlite3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãŒã€ä»Šå¾Œä»–ã‚µã‚¤ãƒˆã§ sqlite3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒé…è³¦ã•ã‚Œã¦ã„ã‚Œã°ã€ãã‚Œã‚’åˆ©ç”¨ã—ã¦ã‚µã‚¤ãƒˆã‚’ä½œã‚‹ã“ã¨ã‚‚å¯èƒ½ãªä½œã‚Šã«ãªã£ã¦ã„ã‚‹ã¨ç¢ºèªã§ããŸã€‚

å‹•ä½œç¢ºèªã«åˆ©ç”¨ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã¯ https://github.com/niku/flutter_for_web_with_sqlite3_sample ã«ã‚ã‚‹ã€‚
